// ============================================================
// Skill Import Test
// Tests importing Skills from external files
// ============================================================

package "demo.koi.import"

// Import the Math Operations skill
import "./skills/math-operations.koi"

role Calculator { can calculate }

// Agent that uses the imported MathOperations skill
Agent MathAgent : Calculator {
  llm default = { provider: "openai", model: "gpt-4o-mini", temperature: 0.1, max_tokens: 200 }
  uses Skill MathOperations

  on calculate(args: Json) {
    playbook """
    Perform the following calculation: ${JSON.stringify(args)}

    Use the available math tools to compute the result.
    Return the result as JSON with the operation and result fields.
    """
  }
}

// Create a team
Team MathTeam {
  calculator = MathAgent
}

// Demo runner
Agent DemoRunner : Calculator {
  uses Team MathTeam

  on runTest(args: Json) {
    console.log("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
    console.log("â•‘  Skill Import Test                         â•‘")
    console.log("â•‘  Testing imported Math Operations          â•‘")
    console.log("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")

    // Test 1: Addition
    console.log("ğŸ“‹ Test 1: Addition (5 + 3)")
    console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")

    const result1 =
      await send peers.event("calculate").role(Calculator).any()({
        operation: "add",
        a: 5,
        b: 3
      }) timeout 10s

    console.log("Result:", JSON.stringify(result1, null, 2))

    // Test 2: Multiplication
    console.log("\nğŸ“‹ Test 2: Multiplication (7 Ã— 6)")
    console.log("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")

    const result2 =
      await send peers.event("calculate").role(Calculator).any()({
        operation: "multiply",
        a: 7,
        b: 6
      }) timeout 10s

    console.log("Result:", JSON.stringify(result2, null, 2))

    return {
      success: true,
      tests_completed: 2
    }
  }
}

run DemoRunner.runTest({})
